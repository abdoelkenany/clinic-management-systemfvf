<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SmartClinic — لوحة تحكم الطبيب</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --primary-light: #3b82f6;
      --secondary: #64748b;
      --accent: #06b6d4;
      --accent-light: #22d3ee;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --light: #f8fafc;
      --dark: #1e293b;
      --white: #ffffff;
      --gradient-primary: linear-gradient(135deg, #2563eb 0%, #06b6d4 100%);
      --gradient-light: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      --gradient-dark: linear-gradient(135deg, #1e3a8a 0%, #0e7490 100%);
      --shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.12);
      --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Cairo", sans-serif;
      background: var(--light);
      color: var(--dark);
      scroll-behavior: smooth;
      line-height: 1.7;
      min-height: 100vh;
    }

    /* Navbar */
    .navbar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 1rem 0;
    }

    .navbar-brand {
      display: flex;
      align-items: center;
      font-weight: 800;
      font-size: 1.6rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .navbar-brand i {
      margin-left: 0.5rem;
      font-size: 1.8rem;
    }

    .doctor-welcome {
      background: var(--gradient-primary);
      color: var(--white);
      padding: 1rem 1.5rem;
      border-radius: 1rem;
      margin-left: 2rem;
    }

    /* Doctor Dashboard */
    .doctor-dashboard {
      padding: 6rem 0 2rem;
      min-height: 100vh;
    }

    .dashboard-header {
      background: var(--gradient-primary);
      color: var(--white);
      padding: 2.5rem;
      border-radius: 1.5rem;
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
    }

    .dashboard-header::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
      opacity: 0.3;
    }

    .doctor-profile {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      position: relative;
      z-index: 2;
    }

    .doctor-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: var(--white);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      color: var(--primary);
      border: 4px solid var(--white);
      box-shadow: var(--shadow);
    }

    .doctor-info h1 {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
    }

    .doctor-specialty {
      background: rgba(255, 255, 255, 0.2);
      padding: 0.5rem 1rem;
      border-radius: 2rem;
      font-weight: 600;
      display: inline-block;
    }

    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--white);
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: var(--shadow);
      text-align: center;
      transition: var(--transition);
      border-left: 4px solid var(--primary);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .stat-card.pending {
      border-left-color: var(--warning);
    }

    .stat-card.completed {
      border-left-color: var(--success);
    }

    .stat-card.cancelled {
      border-left-color: var(--danger);
    }

    .stat-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .stat-card.pending .stat-icon {
      color: var(--warning);
    }

    .stat-card.completed .stat-icon {
      color: var(--success);
    }

    .stat-card.cancelled .stat-icon {
      color: var(--danger);
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      color: var(--secondary);
      font-weight: 600;
    }

    /* Tabs */
    .nav-tabs {
      border-bottom: 2px solid #e2e8f0;
      margin-bottom: 2rem;
    }

    .nav-tabs .nav-link {
      border: none;
      padding: 1rem 2rem;
      font-weight: 700;
      color: var(--secondary);
      border-bottom: 3px solid transparent;
      transition: var(--transition);
    }

    .nav-tabs .nav-link:hover {
      color: var(--primary);
      border-bottom-color: var(--primary-light);
    }

    .nav-tabs .nav-link.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
      background: transparent;
    }

    /* Patient Cards */
    .patient-card {
      background: var(--white);
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
      transition: var(--transition);
      border-right: 4px solid var(--primary);
    }

    .patient-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }

    .patient-card.completed {
      border-right-color: var(--success);
      opacity: 0.8;
    }

    .patient-header {
      display: flex;
      justify-content: between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .patient-info h5 {
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--dark);
    }

    .patient-meta {
      display: flex;
      gap: 1rem;
      color: var(--secondary);
      font-size: 0.9rem;
    }

    .patient-meta i {
      margin-left: 0.5rem;
    }

    .patient-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    .btn-success {
      background: var(--success);
      border-color: var(--success);
    }

    .btn-warning {
      background: var(--warning);
      border-color: var(--warning);
    }

    /* Modal */
    .modal-content {
      border-radius: 1rem;
      border: none;
      box-shadow: var(--shadow-lg);
    }

    .modal-header {
      background: var(--gradient-primary);
      color: var(--white);
      border-radius: 1rem 1rem 0 0;
      border: none;
    }

    .modal-footer {
      border: none;
      padding: 1.5rem;
    }

    .form-label {
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 0.75rem;
    }

    .form-control, .form-select, .form-textarea {
      padding: 0.75rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 0.75rem;
      transition: var(--transition);
    }

    .form-control:focus, .form-select:focus, .form-textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.1);
    }

    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }

    .test-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: var(--light);
      border-radius: 0.75rem;
      margin-bottom: 1rem;
    }

    .test-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--secondary);
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1rem;
      color: #cbd5e1;
    }

    /* Footer */
    footer {
      background: var(--dark);
      color: var(--white);
      text-align: center;
      padding: 2rem 0;
      margin-top: 3rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .doctor-dashboard {
        padding: 5rem 0 1rem;
      }
      
      .doctor-profile {
        flex-direction: column;
        text-align: center;
      }
      
      .dashboard-header {
        padding: 2rem 1.5rem;
      }
      
      .nav-tabs .nav-link {
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
      }
      
      .patient-header {
        flex-direction: column;
        gap: 1rem;
      }
      
      .patient-actions {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg fixed-top">
    <div class="container">
      <a class="navbar-brand" href="index.html">
        <i class="bi bi-heart-pulse-fill"></i>
        SmartClinic
      </a>

      <div class="d-flex align-items-center">
        <div class="doctor-welcome">
          <i class="bi bi-person-circle me-2"></i>
          <span id="doctorName">د. أحمد محمود</span>
        </div>
        
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="mainNav">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="index.html">الرئيسية</a></li>
            <li class="nav-item"><a class="nav-link active" href="doctor.html">لوحتي</a></li>
            <li class="nav-item"><a class="nav-link" href="index.html#contact">الدعم</a></li>
            <li class="nav-item"><a class="nav-link text-danger" href="#" id="logoutBtn"><i class="bi bi-box-arrow-left"></i> تسجيل خروج</a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- Doctor Dashboard -->
  <section class="doctor-dashboard">
    <div class="container">
      <!-- Dashboard Header -->
      <div class="dashboard-header">
        <div class="doctor-profile">
          <div class="doctor-avatar">
            <i class="bi bi-person-badge"></i>
          </div>
          <div class="doctor-info">
            <h1 id="dashboardDoctorName">د. أحمد محمود</h1>
            <div class="doctor-specialty" id="doctorSpecialty">أخصائي باطنة</div>
            <p class="mt-2 mb-0">مرحباً بك في لوحة تحكم SmartClinic</p>
          </div>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="stats-cards">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-people"></i>
          </div>
          <div class="stat-number" id="totalPatients">0</div>
          <div class="stat-label">إجمالي المرضى</div>
        </div>
        
        <div class="stat-card pending">
          <div class="stat-icon">
            <i class="bi bi-clock"></i>
          </div>
          <div class="stat-number" id="pendingPatients">0</div>
          <div class="stat-label">في انتظار الكشف</div>
        </div>
        
        <div class="stat-card completed">
          <div class="stat-icon">
            <i class="bi bi-check-circle"></i>
          </div>
          <div class="stat-number" id="completedPatients">0</div>
          <div class="stat-label">تم الكشف</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-calendar-check"></i>
          </div>
          <div class="stat-number" id="todayAppointments">0</div>
          <div class="stat-label">مواعيد اليوم</div>
        </div>
      </div>

      <!-- Tabs -->
      <ul class="nav nav-tabs" id="doctorTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">
            <i class="bi bi-clock me-2"></i>في انتظار الكشف
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab">
            <i class="bi bi-check-circle me-2"></i>تم الكشف
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab">
            <i class="bi bi-list-ul me-2"></i>جميع المرضى
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content" id="doctorTabContent">
        <!-- Pending Patients -->
        <div class="tab-pane fade show active" id="pending" role="tabpanel">
          <div id="pendingPatientsList">
            <!-- سيتم ملؤها ديناميكياً -->
          </div>
        </div>

        <!-- Completed Patients -->
        <div class="tab-pane fade" id="completed" role="tabpanel">
          <div id="completedPatientsList">
            <!-- سيتم ملؤها ديناميكياً -->
          </div>
        </div>

        <!-- All Patients -->
        <div class="tab-pane fade" id="all" role="tabpanel">
          <div id="allPatientsList">
            <!-- سيتم ملؤها ديناميكياً -->
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Medical Report Modal -->
  <div class="modal fade" id="medicalReportModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-file-medical me-2"></i>تقرير طبي وروشتة</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="patient-summary mb-4">
            <h6>معلومات المريض</h6>
            <div class="row">
              <div class="col-md-6">
                <p><strong>الاسم:</strong> <span id="modalPatientName">-</span></p>
                <p><strong>العمر:</strong> <span id="modalPatientAge">-</span></p>
              </div>
              <div class="col-md-6">
                <p><strong>الهاتف:</strong> <span id="modalPatientPhone">-</span></p>
                <p><strong>التاريخ:</strong> <span id="modalVisitDate">-</span></p>
              </div>
            </div>
          </div>

          <form id="medicalReportForm">
            <input type="hidden" id="modalPatientId">
            
            <div class="mb-3">
              <label class="form-label">التشخيص</label>
              <textarea class="form-control form-textarea" id="diagnosis" placeholder="أدخل التشخيص الطبي..." required></textarea>
            </div>

            <div class="mb-3">
              <label class="form-label">التحاليل المطلوبة</label>
              <div class="tests-list">
                <div class="test-item">
                  <input type="checkbox" id="test1" value="صورة دم كاملة">
                  <label for="test1">صورة دم كاملة (CBC)</label>
                </div>
                <div class="test-item">
                  <input type="checkbox" id="test2" value="سكر صائم">
                  <label for="test2">سكر صائم</label>
                </div>
                <div class="test-item">
                  <input type="checkbox" id="test3" value="وظائف كبد">
                  <label for="test3">وظائف كبد</label>
                </div>
                <div class="test-item">
                  <input type="checkbox" id="test4" value="وظائف كلى">
                  <label for="test4">وظائف كلى</label>
                </div>
                <div class="test-item">
                  <input type="checkbox" id="test5" value="تحليل بول">
                  <label for="test5">تحليل بول</label>
                </div>
                <div class="test-item">
                  <input type="checkbox" id="test6" value="أشعة عادية">
                  <label for="test6">أشعة عادية</label>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">الروشتة الطبية</label>
              <textarea class="form-control form-textarea" id="prescription" placeholder="أدخل الأدوية والتعليمات الطبية..." required></textarea>
            </div>

            <div class="mb-3">
              <label class="form-label">ملاحظات إضافية</label>
              <textarea class="form-control form-textarea" id="notes" placeholder="أي ملاحظات إضافية..."></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
          <button type="button" class="btn btn-success" id="saveMedicalReport">
            <i class="bi bi-check-circle me-2"></i>حفظ التقرير وإرسال النتائج
          </button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <p>&copy; 2025 SmartClinic — جميع الحقوق محفوظة</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // التحقق من تسجيل الدخول للطبيب
    document.addEventListener('DOMContentLoaded', function() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      
      if (!currentUser || currentUser.type !== 'doctor') {
        window.location.href = 'login.html';
        return;
      }
      
      // استمرار في تحميل الصفحة...
      
      // بيانات الأطباء
      const doctorsData = {
        "د. أحمد محمود": { specialty: "باطنة", branch: "القاهرة" },
        "د. ليلى عبد الرحمن": { specialty: "باطنة", branch: "القاهرة" },
        "د. سارة إبراهيم": { specialty: "أطفال", branch: "القاهرة" },
        "د. خالد مصطفى": { specialty: "أطفال", branch: "القاهرة" },
        "د. ريم عماد": { specialty: "أسنان", branch: "القاهرة" },
        "د. سامي يوسف": { specialty: "باطنة", branch: "الإسكندرية" },
        "د. منى حسام": { specialty: "أطفال", branch: "الإسكندرية" },
        "د. هشام فوزي": { specialty: "أسنان", branch: "الإسكندرية" },
        "د. ياسر عبد الله": { specialty: "باطنة", branch: "المنصورة" },
        "د. سمر إبراهيم": { specialty: "أطفال", branch: "المنصورة" },
        "د. كريم حمدي": { specialty: "أسنان", branch: "المنصورة" }
      };

      // بيانات المرضى الافتراضية
      let patientsData = JSON.parse(localStorage.getItem('smartClinicBookings')) || [
        {
          id: 1,
          name: "محمد أحمد",
          email: "mohamed@email.com",
          phone: "01234567891",
          location: "القاهرة",
          specialty: "باطنة",
          doctor: "د. أحمد محمود",
          price: 300,
          date: new Date().toISOString().split('T')[0],
          time: "10:00 صباحًا",
          status: "pending",
          paymentMethod: "نقداً في العيادة",
          paymentStatus: "غير مدفوع"
        },
        {
          id: 2,
          name: "فاطمة محمود",
          email: "fatma@email.com",
          phone: "01234567892",
          location: "القاهرة",
          specialty: "باطنة",
          doctor: "د. أحمد محمود",
          price: 300,
          date: new Date().toISOString().split('T')[0],
          time: "11:00 صباحًا",
          status: "pending",
          paymentMethod: "بطاقة ائتمان",
          paymentStatus: "مدفوع"
        },
        {
          id: 3,
          name: "علي حسن",
          email: "ali@email.com",
          phone: "01234567893",
          location: "القاهرة",
          specialty: "باطنة",
          doctor: "د. أحمد محمود",
          price: 300,
          date: new Date(Date.now() - 86400000).toISOString().split('T')[0],
          time: "09:00 صباحًا",
          status: "completed",
          paymentMethod: "نقداً في العيادة",
          paymentStatus: "مدفوع",
          medicalReport: {
            diagnosis: "نزلة معوية حادة",
            tests: ["صورة دم كاملة", "تحليل بول"],
            prescription: "باراسيتامول 500 مج كل 8 ساعات\nمحلول معالجة الجفاف\nراحة تامة",
            notes: "يجب المتابعة بعد 3 أيام"
          }
        }
      ];

      // الحصول على اسم الطبيب المسجل دخول
      const currentDoctor = currentUser.name;

      // تحديث واجهة الطبيب
      function updateDoctorDashboard() {
        // تحديث معلومات الطبيب
        document.getElementById('doctorName').textContent = currentDoctor;
        document.getElementById('dashboardDoctorName').textContent = currentDoctor;
        document.getElementById('doctorSpecialty').textContent = doctorsData[currentDoctor].specialty;

        // تصفية مرضى الطبيب الحالي
        const doctorPatients = patientsData.filter(patient => 
          patient.doctor === currentDoctor && patient.location === doctorsData[currentDoctor].branch
        );

        const pendingPatients = doctorPatients.filter(p => p.status === 'pending');
        const completedPatients = doctorPatients.filter(p => p.status === 'completed');
        const todayPatients = doctorPatients.filter(p => p.date === new Date().toISOString().split('T')[0]);

        // تحديث الإحصائيات
        document.getElementById('totalPatients').textContent = doctorPatients.length;
        document.getElementById('pendingPatients').textContent = pendingPatients.length;
        document.getElementById('completedPatients').textContent = completedPatients.length;
        document.getElementById('todayAppointments').textContent = todayPatients.length;

        // عرض المرضى
        renderPatientsList('pendingPatientsList', pendingPatients, 'pending');
        renderPatientsList('completedPatientsList', completedPatients, 'completed');
        renderPatientsList('allPatientsList', doctorPatients, 'all');
      }

      // عرض قائمة المرضى
      function renderPatientsList(containerId, patients, type) {
        const container = document.getElementById(containerId);
        
        if (patients.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <i class="bi bi-${type === 'pending' ? 'clock' : type === 'completed' ? 'check-circle' : 'people'}"></i>
              <h4>لا توجد بيانات</h4>
              <p>${type === 'pending' ? 'لا توجد مواعيد في انتظار الكشف' : type === 'completed' ? 'لا توجد مواعيد مكتملة' : 'لا توجد مواعيد'}</p>
            </div>
          `;
          return;
        }

        container.innerHTML = patients.map(patient => `
          <div class="patient-card ${patient.status === 'completed' ? 'completed' : ''}" data-patient-id="${patient.id}">
            <div class="patient-header">
              <div class="patient-info">
                <h5>${patient.name}</h5>
                <div class="patient-meta">
                  <span><i class="bi bi-telephone"></i> ${patient.phone}</span>
                  <span><i class="bi bi-calendar"></i> ${patient.date}</span>
                  <span><i class="bi bi-clock"></i> ${patient.time}</span>
                  <span class="badge ${patient.paymentStatus === 'مدفوع' ? 'bg-success' : 'bg-warning'}">${patient.paymentStatus}</span>
                </div>
              </div>
              <div class="patient-actions">
                ${patient.status === 'pending' ? `
                  <button class="btn btn-primary btn-sm" onclick="openMedicalReport(${patient.id})">
                    <i class="bi bi-file-medical me-1"></i>كشف وروشتة
                  </button>
                  <button class="btn btn-success btn-sm" onclick="completeAppointment(${patient.id})">
                    <i class="bi bi-check-circle me-1"></i>إنهاء الكشف
                  </button>
                ` : `
                  <button class="btn btn-outline-primary btn-sm" onclick="viewMedicalReport(${patient.id})">
                    <i class="bi bi-eye me-1"></i>عرض التقرير
                  </button>
                `}
              </div>
            </div>
            ${patient.medicalReport ? `
              <div class="patient-summary">
                <strong>التشخيص:</strong> ${patient.medicalReport.diagnosis}
              </div>
            ` : ''}
          </div>
        `).join('');
      }

      // فتح نموذج التقرير الطبي
      function openMedicalReport(patientId) {
        const patient = patientsData.find(p => p.id === patientId);
        if (!patient) return;

        document.getElementById('modalPatientId').value = patientId;
        document.getElementById('modalPatientName').textContent = patient.name;
        document.getElementById('modalPatientPhone').textContent = patient.phone;
        document.getElementById('modalVisitDate').textContent = `${patient.date} - ${patient.time}`;
        
        // إعادة تعيين النموذج
        document.getElementById('medicalReportForm').reset();
        
        const modal = new bootstrap.Modal(document.getElementById('medicalReportModal'));
        modal.show();
      }

      // عرض التقرير الطبي
      function viewMedicalReport(patientId) {
        const patient = patientsData.find(p => p.id === patientId);
        if (!patient || !patient.medicalReport) return;

        alert(`
          التقرير الطبي للمريض: ${patient.name}
          
          التشخيص: ${patient.medicalReport.diagnosis}
          
          التحاليل المطلوبة: ${patient.medicalReport.tests.join('، ')}
          
          الروشتة: ${patient.medicalReport.prescription}
          
          الملاحظات: ${patient.medicalReport.notes || 'لا توجد ملاحظات'}
        `);
      }

      // حفظ التقرير الطبي
      document.getElementById('saveMedicalReport').addEventListener('click', function() {
        const patientId = parseInt(document.getElementById('modalPatientId').value);
        const diagnosis = document.getElementById('diagnosis').value;
        const prescription = document.getElementById('prescription').value;
        const notes = document.getElementById('notes').value;

        if (!diagnosis || !prescription) {
          alert('يرجى ملء جميع الحقول المطلوبة');
          return;
        }

        // جمع التحاليل المختارة
        const selectedTests = [];
        document.querySelectorAll('.tests-list input[type="checkbox"]:checked').forEach(checkbox => {
          selectedTests.push(checkbox.value);
        });

        // تحديث بيانات المريض
        const patientIndex = patientsData.findIndex(p => p.id === patientId);
        if (patientIndex !== -1) {
          patientsData[patientIndex].medicalReport = {
            diagnosis,
            tests: selectedTests,
            prescription,
            notes,
            reportDate: new Date().toISOString()
          };

          patientsData[patientIndex].status = 'completed';
          
          // حفظ في localStorage
          localStorage.setItem('smartClinicBookings', JSON.stringify(patientsData));
          
          // إغلاق المودال وتحديث الواجهة
          bootstrap.Modal.getInstance(document.getElementById('medicalReportModal')).hide();
          updateDoctorDashboard();
          
          alert('تم حفظ التقرير الطبي بنجاح وتم إرسال النتائج للمريض');
        }
      });

      // إنهاء الكشف بدون تقرير
      function completeAppointment(patientId) {
        if (confirm('هل تريد إنهاء الكشف بدون إضافة تقرير طبي؟')) {
          const patientIndex = patientsData.findIndex(p => p.id === patientId);
          if (patientIndex !== -1) {
            patientsData[patientIndex].status = 'completed';
            localStorage.setItem('smartClinicBookings', JSON.stringify(patientsData));
            updateDoctorDashboard();
            alert('تم إنهاء الكشف بنجاح');
          }
        }
      }

      // تسجيل الخروج
      document.getElementById('logoutBtn').addEventListener('click', function(e) {
        e.preventDefault();
        if (confirm('هل تريد تسجيل الخروج؟')) {
          localStorage.removeItem('currentUser');
          window.location.href = 'login.html';
        }
      });

      // تهيئة الصفحة
      updateDoctorDashboard();
      
      // تحديث البيانات كل 30 ثانية
      setInterval(updateDoctorDashboard, 30000);
    });
  </script>
</body>
</html>